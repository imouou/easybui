!function(){function e(){this.config={id:".editor",sourcePath:"/demo",mode:"text/javascript",lineNumbers:!0,lineWrapping:!1,theme:"jsbin",styleActiveLine:!0,foldGutter:!1,spa:!1,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],matchBrackets:!0,fixedGutter:!0,readOnly:!0},this.editorCode={},this.option=null,this.cacheScript="",this.param=this.getUrlParams()||{}}e.prototype.objectToKeyString=function(t,e){var o="";for(var n in t){o+="&"+n+"="+(e?encodeURIComponent(t[n]):t[n])}return o.substr(1)},e.prototype.keyStringToObject=function(t,e){var o,n={},r=[];try{for(r=t.split("&"),o=0;o<r.length;o++){var i=e?decodeURIComponent(r[o].split("=")[1]):r[o].split("=")[1];n[r[o].split("=")[0]]=i}}catch(t){ui.showLog(t)}return n},e.prototype.setUrlParams=function(t,e,o){o=0!=o,e="object"==typeof e?e:{};var n=this.objectToKeyString(e,o);return""==n?t:t+"?"+n},e.prototype.getUrlParams=function(t){t=0!=t;var e=window.frames.location.search||window.location.search,o={};if(-1<e.indexOf("?")){var n=e.substr(1),r=(o=this.keyStringToObject(n,t)).url&&o.url.indexOf(".html");o.url=-1<r?o.url.substr(0,r):o.url}return o},e.prototype.tplNav=function(t){var e="";return(t=t||[]).forEach(function(t){e+='<li class="bui-btn active">'+t+"</div>"}),e},e.prototype.column=function(){var t,s=this,u=function(){var t=s.getUrlParams()||{};return"code"in t&&t.code.length?-1<t.code.indexOf(",")?t.code.split(","):[t.code]:[]},d=function(t){document.querySelector('[data-target="'+t+'"]')&&document.querySelector('[data-target="'+t+'"]').classList.add("active"),document.querySelector('[data-code="'+t+'"]').style.display="block"};["full","html","js","css","result"].forEach(function(t){var e=document.querySelectorAll('[data-code="'+t+'"]');[].slice.call(e,0).forEach(function(t){t.style.display="none"})}),u().forEach(function(t){d(t)}),t=document.querySelectorAll(".bui-nav li"),[].slice.call(t,0).forEach(function(t){t.onclick=function(){var o,n,t,e=u(),r=this.getAttribute("data-target");this.classList.contains("active")?(t=r,document.querySelector('[data-target="'+t+'"]').classList.remove("active"),document.querySelector('[data-code="'+t+'"]').style.display="none",o=r,(n=e).map(function(t,e){o===t&&n.splice(e,1)}),e=n):(d(r),e.push(r));var i,l,a,c=e.length?{url:s.param.url,code:e.join(",")}:{url:s.param.url};i=c,l=window.location.origin+window.location.pathname,a=bui.setUrlParams(l,i,!1),window.history&&window.history.replaceState(null,null,a)}})},e.prototype.fullscreen=function(){var t=window.innerHeight-document.querySelector(".header").offsetHeight;for(var e in this.editorCode)this.editorCode[e].setSize("100%",t);this.getId("preview").height=t},e.prototype.selectAll=function(){for(var t in this.editorCode){var e=this.editorCode[t].lastLine();this.editorCode[t].setSelection({line:0,ch:0},{line:e,ch:0})}},e.prototype.tplHtml=function(){return'<!DOCTYPE HTML>\n<html>\n\t<head>\n\t\t<meta charset="utf-8">\n\t\t<title>BUI示例</title>\n\t\t<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">\n\t\t<link rel="stylesheet" href="https://www.easybui.com/demo/css/bui.css">\n\t\t<script src="https://www.easybui.com/demo/js/zepto.js"></script>\n\t\t<script src="https://www.easybui.com/demo/js/bui.js"></script>\n\t</head>\n\t<body>\n\t\n\t</body>\n</html>'},e.prototype.getId=function(t){return document.getElementById(t)},e.prototype.parseTemplate=function(){var t=this.editorCode.html.getValue()||"",e="\t<style>"+(this.editorCode.css.getValue()||"")+"</style>",o="<script>"+(this.translatePage(this.editorCode.javascript.getValue())||"")+"\n</script>";return(-1<t.indexOf("<body>")&&-1<t.indexOf("</body>")?t:this.tplHtml()).replace("\n\t</body>",t+"\n</body>").replace("</head>",e+"\n\t</head>").replace("</body>",o+"\n</body>")},e.prototype.render=function(t){t=t||"preview";var e=document.getElementById(t),o=this.editorCode.full.getValue(),n=document.all?e.contentWindow.document:e.contentDocument;n.open(),n.write(o),n.close()},e.prototype.copy=function(t){var n=this;new ClipboardJS(t,{text:function(t){var e=t.getAttribute("data-target"),o=e in n.editorCode?n.editorCode[e].getValue():o||n.editorCode.full.getValue();return o}}).on("success",function(){bui.hint({content:"<i class='icon-check'></i><br />复制成功!",position:"center",effect:"fadeInDown"})})},e.prototype.qrcode=function(){var t=this.getUrlParams(),e=(window.frames.location.origin||window.location.origin)+this.option.sourcePath+"/"+"#"+t.url;new QRCode(document.getElementById("qrcode"),e)},e.prototype.getPath=function(t){return t.match(/.+\//g)},e.prototype.bindCopyShow=function(){var t=document.querySelectorAll(".CodeMirror");[].slice.call(t,0).forEach(function(t){t.onmouseover=function(t){var e=this.nextElementSibling;"block"!=e.style.display&&(e.style.display="block",t.stopPropagation())},t.onmouseout=function(t){var e=this.nextElementSibling;"none"!=e.style.display&&(e.style.display="none",t.stopPropagation())}});var e=document.querySelectorAll(".main .copy");[].slice.call(e,0).forEach(function(e){e.onmouseover=function(t){e.style.display="block",t.stopPropagation()},e.onmouseout=function(t){e.style.display="none",t.stopPropagation()}})},e.prototype.renderFull=function(){var t=this.parseTemplate();this.editorCode.full.setValue(t),this.translateModule(this.editorCode.javascript.getValue())},e.prototype.bind=function(){var t=this;this.getId("run").onclick=function(){t.render()},this.getId("jszipspa").onclick=function(){t.runzip("spa")},this.getId("jszip").onclick=function(){t.runzip()},this.copy(".copy"),this.bindCopyShow(),window.onresize=function(){t.fullscreen()}},e.prototype.parseHtml=function(){var r=this,t=this.getUrlParams();try{var e=new Promise(function(o,n){t.url&&$.ajax({url:t.url+".html",success:function(e){var t=document.querySelectorAll(r.option.id);[].slice.call(t,0).forEach(function(t){"html"==t.getAttribute("data-type")&&r.editorCode.html.setValue(e)}),o(e)},error:function(t,e,o){n(t,e,o)}})})}catch(t){console.log(t)}return e},e.prototype.runzip=function(t){var e=new JSZip,o=this.editorCode.full.getValue(),n=this.editorCode.html.getValue(),r=this.translateModule(this.editorCode.javascript.getValue()),i=this.getUrlParams(),l=i.url.substr(i.url.lastIndexOf("/")+1);return"spa"==t?e.folder(l).file("index.html",n).file("index.js",r):e.folder(l).file("index.html",o),e.generateAsync({type:"blob"}).then(function(t){saveAs(t,l+".zip")},function(t){bui.alert(t)}),this},e.prototype.translatePage=function(t){var e=void 0===t?this.cacheScript:t,o=/(loader\.define|bui\.define|define).[^\{]+/i,n="";return n=(n=o.test(e)?e.replace(o,"bui.ready(function()"):e).replace(/router\.+\$\(/gi,"$("),this.editorCode.javascript.setValue(n),n},e.prototype.translateModule=function(t){var e=void 0===t?this.cacheScript:t,o=/(bui\.ready).[^\{]+/i,n="";return n=(n=o.test(e)?e.replace(o,"loader.define(function()"):e).replace(/^$\(/gi,"router.$("),this.editorCode.javascript.setValue(n),n},e.prototype.parseJs=function(){var r=this,t=this.getUrlParams();try{var e=new Promise(function(o,n){t.url&&$.ajax({url:t.url+".js",success:function(t){r.cacheScript=t;try{var e=r.translateModule(t);o(e)}catch(t){}},error:function(t,e,o){n(t,e,o)}})})}catch(t){console.log(t)}return e},e.prototype.init=function(t){var r=this;r.option=$.extend(!0,{},r.config,t);var e=document.querySelectorAll(r.option.id);[].slice.call(e,0).forEach(function(t){var e=t.getAttribute("data-type"),o="text/"+("full"==e?"html":e),n=$.extend(!0,{},r.option,{mode:o});r.editorCode[e]=CodeMirror.fromTextArea(t,n)});try{Promise.all([r.parseHtml(),r.parseJs()]).catch(function(){}).then(function(){r.renderFull(),r.render(),r.column(),r.fullscreen(),r.bind()},function(){r.renderFull(),r.render(),r.column(),r.fullscreen(),r.bind()})}catch(t){console.log(t)}},window.oEditor=function(t){return new e(t)}}(window);